{"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"url": "data/chart1_exposures.json", "format": {"type": "json"}}, "mark": {"type": "line", "point": true}, "encoding": {"color": {"value": "#2A2E34"}, "tooltip": [{"field": "date", "format": "%Y-%m", "title": "Date", "type": "temporal"}, {"field": "hhi_index", "format": ",.0f", "title": "HHI", "type": "quantitative"}], "x": {"axis": {"format": "%Y"}, "field": "date", "timeUnit": "yearmonth", "title": "", "type": "temporal"}, "y": {"field": "hhi_index", "title": "HHI (0-10,000)", "type": "quantitative"}}, "height": 300, "params": [{"name": "entity", "value": "world"}], "title": "Liability concentration across lenders (HHI)", "transform": [{"lookup": "L_REP_CTY", "from": {"data": {"url": "data/chart1_metadata.json", "format": {"type": "json"}}, "key": "L_REP_CTY", "fields": ["country_name_rep", "region_rep"]}}, {"filter": "entity == 'world' || datum.country_name_rep == entity || datum.region_rep == entity"}, {"filter": "datum.L_POSITION == 'L'"}, {"aggregate": [{"op": "sum", "field": "OBS_VALUE", "as": "liability_by_cp"}], "groupby": ["date", "L_CP_COUNTRY"]}, {"joinaggregate": [{"op": "sum", "field": "liability_by_cp", "as": "total_liabilities"}], "groupby": ["date"]}, {"calculate": "datum.total_liabilities > 0 ? datum.liability_by_cp / datum.total_liabilities : 0", "as": "share"}, {"calculate": "datum.share * datum.share", "as": "share_sq"}, {"aggregate": [{"op": "sum", "field": "share_sq", "as": "hhi"}], "groupby": ["date"]}, {"calculate": "datum.hhi * 10000", "as": "hhi_index"}], "width": 800, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json"}